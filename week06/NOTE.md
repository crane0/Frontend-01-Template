# 每周总结可以写在这里

具体的学习总结都在写代码中了。


1，学习到了如何在 vscode 中如何打断点，快捷监听某个表达式等调试方法。

2，使用状态机解析 html 时，标签如何处理，老师给的代码截图中，并不完整，

自己通过调试实现了自封闭标签，如 img 最终也添加到 DOM 树中。

3，如何使用 [css解析依赖](https://www.npmjs.com/package/css) ，将 style 标签中的 css 样式解析为 AST 抽象语法树。

并最终将计算完成后的带有优先级的 computedStyle 添加到 element 上。

# 2，解析 css 时的步骤

## 2.1，收集 CSS 规则

> 这里只考虑 style 标签中的文本内容。

遇到 style 标签时，调用 css Parser 来分析 css 规则，并将 css 规则保存。

这里需要仔细研究此库，分析 css 规则的格式。

## 2.2，添加调用

当创建一个元素后，应立即计算 css

理论上，当分析一个元素时，所有 css 规则已经收集完毕，

在真是浏览器中，可能会遇到写在 body 中的 style 标签，需要重新计算 css，这里忽略。

重新 css 计算 --> 重排 --> 重绘

所以，最佳实践：所有的 style 标签都应该写在所有的元素之前。

## 2.3，获取父元素序列

在 computeCSS 函数中，必须知道元素的所有父元素，才能判断元素与规则是否匹配

在 stack 中，可以获取本元素的所有父元素。

因为首先获取的是“当前元素”，所以获取和计算父元素匹配的顺序是从内到外。

比如，`body div img { }` 这样的选择器，
- `img` 匹配的肯定有当前元素。 
- 只知道父级，并不知道匹配哪个元素。


## 2.4，拆分选择器

选择器也要从当前元素向外排列

复杂选择器拆成针对单个元素的选择器，用循环匹配父元素队列。

## 2.5，计算选择器与元素匹配

对应的 match 方法。

根据选择器的类型和元素属性，计算是否与当前元素匹配。

> 这里仅实现 id class 和标签3种选择器，实例的浏览器中要处理符合选择器。


## 2.6，生成 computed 属性

对应上个步骤中，matched 匹配之后的逻辑：

一旦选择匹配，就应用选择器到元素上，computedStyle。

## 2.7，specificity

可理解为选择器优先级。对应代码中 `specificity` 方法。

一个四元组的形式，最右边是高位，从右往左，只要有一个比其他的大，最终样式就用该选择器。




